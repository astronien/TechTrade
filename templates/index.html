<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Trade-In</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
        }

        .sidebar-logo {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .sidebar-menu a:hover {
            background: #f0f0f0;
            color: #667eea;
        }

        .sidebar-menu a.active {
            background: #667eea;
            color: white;
        }

        .sidebar-menu a span {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .search-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
            font-size: 14px;
        }

        input,
        select {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
            background: #5568d3;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: #6c757d;
        }

        button.secondary:hover {
            background: #5a6268;
        }

        .data-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            min-height: 400px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #667eea;
            font-size: 18px;
        }

        .error {
            background: #fee;
            border: 2px solid #fcc;
            color: #c33;
            padding: 20px;
            border-radius: 10px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 13px;
        }

        .data-table th,
        .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }

        .summary {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .summary-item {
            display: inline-block;
            margin-right: 20px;
            font-weight: 600;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
        }

        .action-bar {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .action-bar button {
            padding: 10px 20px;
            font-size: 14px;
        }

        .action-bar button.danger {
            background: #dc3545;
        }

        .action-bar button.danger:hover {
            background: #c82333;
        }

        .checkbox-cell {
            text-align: center;
            width: 40px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .selected-row {
            background: #e3f2fd !important;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .modal-header {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #667eea;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #d63384;
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-logo">üìä Trade-In</div>
        <ul class="sidebar-menu">
            <li><a href="#" class="active" onclick="showPage('search', event); return false;"><span>üîç</span> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a></li>
            <li><a href="#" onclick="showPage('report', event); return false;"><span>üìà</span> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏ó‡∏£‡∏î</a></li>
            <li><a href="#" onclick="openSettings(); return false;"><span>‚öôÔ∏è</span> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</a></li>
            <li><a href="#" onclick="showTelegramSetup(); return false;"><span>üì±</span> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Search Page -->
        <div id="searchPage" class="page-section active">
            <div class="container">
                <h1>üîç ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Trade-In</h1>

        <!-- Extension Banner -->
        <div id="extensionBanner"
            style="display: none; background: #fff3cd; border: 2px solid #ffc107; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="flex: 1;">
                    <h3 style="margin: 0 0 5px 0; color: #856404;">üîå ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Extension!</h3>
                    <p style="margin: 0 0 10px 0; color: #856404; font-size: 14px;">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Session ID ‡πÄ‡∏≠‡∏á -
                        ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏µ‡∏¢‡∏á 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                    <button onclick="window.location.href='/install-extension'"
                        style="background: #28a745; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                        üì• ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Extension
                    </button>
                    <button onclick="dismissBanner()"
                        style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                        ‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á
                    </button>
                </div>
                <button onclick="dismissBanner()"
                    style="background: transparent; border: none; font-size: 24px; cursor: pointer; color: #856404; padding: 0 10px;">√ó</button>
            </div>
        </div>

        <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px;">
            <div>
                <button onclick="window.open('https://eve.techswop.com/TI/login.aspx', '_blank')"
                    style="padding: 8px 20px; font-size: 14px; background: #28a745;">üîê Login ‡∏£‡∏∞‡∏ö‡∏ö</button>
                <span id="statusText" style="margin-left: 10px; color: white; font-size: 14px;">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ login
                    ‡∏Å‡πà‡∏≠‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
            </div>
            <div>
                <button onclick="openSettings()" class="secondary" style="padding: 8px 20px; font-size: 14px;">‚öôÔ∏è
                    ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>

        <div class="search-panel">
            <form id="searchForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                        <input type="text" id="saleCode" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">
                    </div>

                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ó‡∏£‡∏î (‡∏à‡∏≤‡∏Å)</label>
                        <input type="date" id="dateStart" required>
                    </div>

                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ó‡∏£‡∏î (‡∏ñ‡∏∂‡∏á)</label>
                        <input type="date" id="dateEnd" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ó‡∏£‡∏î</label>
                        <select id="status">
                            <option value="">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="1">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤</option>
                            <option value="2">‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏Ñ‡∏≤</option>
                            <option value="3">‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤</option>
                            <option value="4">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="5">‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤</option>
                            <option value="6">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</option>
                            <option value="7">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</label>
                        <select id="brand" multiple size="1">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="TRUSCO">TRUSCO</option>
                            <option value="Acer">Acer</option>
                            <option value="Apple">Apple</option>
                            <option value="Asus">Asus</option>
                            <option value="Avita">Avita</option>
                            <option value="BOX">BOX</option>
                            <option value="COM7">COM7</option>
                            <option value="Dell">Dell</option>
                            <option value="Fujitsu">Fujitsu</option>
                            <option value="Garmin">Garmin</option>
                            <option value="Gigabyte">Gigabyte</option>
                            <option value="Honor">Honor</option>
                            <option value="HP">HP</option>
                            <option value="Huawei">Huawei</option>
                            <option value="Infinix">Infinix</option>
                            <option value="Lenovo">Lenovo</option>
                            <option value="LG">LG</option>
                            <option value="Microsoft">Microsoft</option>
                            <option value="MSI">MSI</option>
                            <option value="Nintendo">Nintendo</option>
                            <option value="Nothing">Nothing</option>
                            <option value="OnePlus">OnePlus</option>
                            <option value="Oppo">Oppo</option>
                            <option value="Realme">Realme</option>
                            <option value="Samsung">Samsung</option>
                            <option value="Sony">Sony</option>
                            <option value="Vivo">Vivo</option>
                            <option value="Xiaomi">Xiaomi</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>‡∏£‡∏∏‡πà‡∏ô</label>
                        <input type="text" id="series" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏∏‡πà‡∏ô">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</label>
                        <select id="docRefType">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="1">‡∏£‡∏∞‡∏ö‡∏∏</option>
                            <option value="0">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</label>
                        <input type="text" id="docRefNumber" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£">
                    </div>

                    <div class="form-group">
                        <label>‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå)</label>
                        <input type="text" id="promoCode" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏Ñ‡πâ‡∏î‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô">
                    </div>

                    <div class="form-group">
                        <label>‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                        <select id="customerSign">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="1">‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
                            <option value="2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ã‡πá‡∏ô</option>
                        </select>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                    <button type="button" class="secondary" onclick="resetForm()">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
                </div>
            </form>
        </div>

        <div class="data-container" id="dataContainer">
            <p style="text-align: center; color: #999; padding: 50px;">
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            </p>
        </div>
            </div>
        </div>
        <!-- End Search Page -->

        <!-- Report Page -->
        <div id="reportPage" class="page-section">
            <div class="container">
                <h1>üìà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏ó‡∏£‡∏î</h1>

                <div class="search-panel">
                    <form id="reportForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                                <input type="text" id="reportSaleCode" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">
                            </div>

                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                                <input type="date" id="reportDateStart" required>
                            </div>

                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                                <input type="date" id="reportDateEnd" required>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="submit">üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                            <button type="button" class="secondary" onclick="resetReportForm()">üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</button>
                        </div>
                    </form>
                </div>

                <div class="data-container" id="reportContainer">
                    <p style="text-align: center; color: #999; padding: 50px;">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                    </p>
                </div>
            </div>
        </div>
        <!-- End Report Page -->
    </div>

    <!-- Modal ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeSettings()">&times;</span>
                ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                    <input type="text" id="settingEmpCode" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                    <input type="text" id="settingEmpName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                    <input type="text" id="settingEmpPhone" placeholder="‡πÄ‡∏ä‡πà‡∏ô 081-234-5678">
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                    <select id="settingCancelType">
                        <option value="1">‡πÇ‡∏î‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢</option>
                        <option value="2">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                    <select id="settingReasonCancel">
                        <option value="1">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏à‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á</option>
                        <option value="2">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</option>
                        <option value="3">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                </div>
                <hr style="margin: 20px 0; border: none; border-top: 1px solid #ddd;">
                <h3 style="font-size: 1.1em; margin-bottom: 15px; color: #667eea;">üç™ Session Cookie
                    (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label>ASP.NET_SessionId</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="settingSessionId" placeholder="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Browser DevTools" style="flex: 1;">
                        <button onclick="autoFetchSession(event)" style="padding: 10px 20px; white-space: nowrap;">
                            üîÑ ‡∏î‡∏∂‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        </button>
                    </div>
                </div>
                <p style="color: #666; font-size: 14px;">
                    üí° <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏î‡∏∂‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)</strong><br>
                    - ‡∏Å‡∏î "üîÑ ‡∏î‡∏∂‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥" ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ eve.techswop.com ‚Üí Login ‚Üí Copy Session ID ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ß‡∏≤‡∏á<br><br>
                    
                    üí° <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏î‡∏∂‡∏á‡∏î‡πâ‡∏ß‡∏¢ Console</strong><br>
                    1. Login ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö eve.techswop.com<br>
                    2. ‡∏Å‡∏î F12 ‚Üí Console<br>
                    3. ‡∏û‡∏¥‡∏°‡∏û‡πå: <code>document.cookie.match(/ASP\.NET_SessionId=([^;]+)/)[1]</code><br>
                    4. Copy ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
                </p>
            </div>
            <div class="modal-footer">
                <button onclick="closeSettings()" class="secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="saveSettings()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        window.addEventListener('load', () => {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);

            document.getElementById('dateStart').valueAsDate = yesterday;
            document.getElementById('dateEnd').valueAsDate = today;
            document.getElementById('reportDateStart').valueAsDate = yesterday;
            document.getElementById('reportDateEnd').valueAsDate = today;

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å localStorage
            loadEmployeeSettings();

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Extension ‡πÅ‡∏•‡∏∞ Session ID
            checkExtensionAndSession();
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤
        function showPage(pageName, event) {
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });

            // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            if (pageName === 'search') {
                document.getElementById('searchPage').classList.add('active');
            } else if (pageName === 'report') {
                document.getElementById('reportPage').classList.add('active');
            }

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏°‡∏ô‡∏π active
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
            });
            if (event) {
                event.target.closest('a').classList.add('active');
            }
        }

        function checkExtensionAndSession() {
            const sessionId = localStorage.getItem('sessionId');
            const dismissed = localStorage.getItem('extensionBannerDismissed');
            const statusText = document.getElementById('statusText');

            if (sessionId) {
                // ‡∏°‡∏µ Session ID ‡πÅ‡∏•‡πâ‡∏ß
                statusText.textContent = '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                statusText.style.color = '#90EE90';
            } else {
                // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Session ID
                if (!dismissed) {
                    // ‡πÅ‡∏™‡∏î‡∏á banner ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Extension
                    document.getElementById('extensionBanner').style.display = 'block';
                }
                statusText.textContent = '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Session ID';
            }
        }

        function dismissBanner() {
            document.getElementById('extensionBanner').style.display = 'none';
            localStorage.setItem('extensionBannerDismissed', 'true');
        }

        function openSettings() {
            document.getElementById('settingsModal').classList.add('show');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('show');
        }

        function saveSettings() {
            const empCode = document.getElementById('settingEmpCode').value;
            const empName = document.getElementById('settingEmpName').value;
            const empPhone = document.getElementById('settingEmpPhone').value;
            const cancelType = document.getElementById('settingCancelType').value;
            const reasonCancel = document.getElementById('settingReasonCancel').value;
            const sessionId = document.getElementById('settingSessionId').value;

            if (!empCode || !empName || !empPhone) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            if (!sessionId) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Session ID (‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á)');
                return;
            }

            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
            localStorage.setItem('empCode', empCode);
            localStorage.setItem('empName', empName);
            localStorage.setItem('empPhone', empPhone);
            localStorage.setItem('cancelType', cancelType);
            localStorage.setItem('reasonCancel', reasonCancel);
            localStorage.setItem('sessionId', sessionId);

            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
            closeSettings();
        }

        function loadEmployeeSettings() {
            const empCode = localStorage.getItem('empCode') || '';
            const empName = localStorage.getItem('empName') || '';
            const empPhone = localStorage.getItem('empPhone') || '';
            const cancelType = localStorage.getItem('cancelType') || '1';
            const reasonCancel = localStorage.getItem('reasonCancel') || '1';
            const sessionId = localStorage.getItem('sessionId') || '';

            document.getElementById('settingEmpCode').value = empCode;
            document.getElementById('settingEmpName').value = empName;
            document.getElementById('settingEmpPhone').value = empPhone;
            document.getElementById('settingCancelType').value = cancelType;
            document.getElementById('settingReasonCancel').value = reasonCancel;
            document.getElementById('settingSessionId').value = sessionId;
        }

        async function autoFetchSession(event) {
            event.preventDefault();
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.disabled = true;
            button.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤...';
            
            // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ eve.techswop.com ‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
            const eveWindow = window.open('https://eve.techswop.com/TI/login.aspx', '_blank');
            
            if (!eveWindow) {
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï Pop-up ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏ô‡∏µ‡πâ');
                button.disabled = false;
                button.innerHTML = originalText;
                return;
            }
            
            button.innerHTML = '‚è≥ ‡∏£‡∏≠ Login...';
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
            const instructions = `
üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á Session ID:

1. ‚úÖ Login ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤
2. ‚úÖ ‡∏Å‡∏î F12 ‡πÄ‡∏õ‡∏¥‡∏î DevTools
3. ‚úÖ ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö Console
4. ‚úÖ ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ:

document.cookie.match(/ASP\\.NET_SessionId=([^;]+)/)[1]

5. ‚úÖ Copy ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ
6. ‚úÖ ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á Session ID ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô

üí° ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Extension ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥!
            `.trim();
            
            // ‡πÅ‡∏™‡∏î‡∏á modal ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
            if (confirm(instructions + '\n\n‡∏Å‡∏î OK ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß')) {
                // Copy ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á clipboard
                try {
                    await navigator.clipboard.writeText('document.cookie.match(/ASP\\.NET_SessionId=([^;]+)/)[1]');
                    alert('‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Clipboard ‡πÅ‡∏•‡πâ‡∏ß!\n‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Console ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤');
                } catch (err) {
                    console.log('Cannot copy to clipboard:', err);
                }
            }
            
            button.disabled = false;
            button.innerHTML = originalText;
        }

        // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å modal
        window.onclick = function (event) {
            const modal = document.getElementById('settingsModal');
            if (event.target == modal) {
                closeSettings();
            }
        }

        async function loginToSystem() {
            const username = localStorage.getItem('username') || '';
            const password = localStorage.getItem('password') || '';

            if (!username || !password) {
                throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• login ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
            }

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: username,
                        password: password
                    })
                });

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'Login ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                }

                return result.cookies;
            } catch (error) {
                throw new Error(`Login ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`);
            }
        }

        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await searchData();
        });

        function resetForm() {
            document.getElementById('searchForm').reset();
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            document.getElementById('dateStart').valueAsDate = yesterday;
            document.getElementById('dateEnd').valueAsDate = today;
        }

        function formatDateThai(dateStr) {
            const date = new Date(dateStr);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear(); // ‡πÉ‡∏ä‡πâ ‡∏Ñ.‡∏®.
            return `${day}/${month}/${year}`;
        }

        async function searchData() {
            const container = document.getElementById('dataContainer');
            const submitBtn = document.querySelector('button[type="submit"]');

            container.innerHTML = '<div class="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>';
            submitBtn.disabled = true;

            // ‡∏î‡∏∂‡∏á Session ID ‡∏à‡∏≤‡∏Å localStorage
            const sessionId = localStorage.getItem('sessionId') || '';
            
            const params = new URLSearchParams({
                saleCode: document.getElementById('saleCode').value,
                dateStart: formatDateThai(document.getElementById('dateStart').value),
                dateEnd: formatDateThai(document.getElementById('dateEnd').value),
                status: document.getElementById('status').value,
                brand: document.getElementById('brand').value,
                series: document.getElementById('series').value,
                docRefType: document.getElementById('docRefType').value,
                docRefNumber: document.getElementById('docRefNumber').value,
                promoCode: document.getElementById('promoCode').value,
                customerSign: document.getElementById('customerSign').value,
                sessionId: sessionId
            });

            try {
                const response = await fetch(`/api/data?${params}`);
                const data = await response.json();

                if (data.error) {
                    container.innerHTML = `
                        <div class="error">
                            <h3>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                            <p>${data.error}</p>
                        </div>
                    `;
                } else {
                    displayData(data);
                }
            } catch (error) {
                container.innerHTML = `
                    <div class="error">
                        <h3>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                submitBtn.disabled = false;
            }
        }

        function displayData(data) {
            const container = document.getElementById('dataContainer');

            // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            const recordsTotal = data.recordsTotal || 0;
            const recordsFiltered = data.recordsFiltered || recordsTotal;
            const dataArray = data.data || [];

            let html = `
                <div class="summary">
                    <span class="summary-item">üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${recordsTotal} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    <span class="summary-item">üîç ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ${recordsFiltered} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    <span class="summary-item">üìÑ ‡πÅ‡∏™‡∏î‡∏á: ${dataArray.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                </div>
            `;

            if (dataArray.length === 0) {
                html += '<p style="text-align: center; color: #999; padding: 50px;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
            } else {
                html += `
                    <div class="action-bar">
                        <div>
                            <span id="selectedCount" style="font-weight: 600;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        </div>
                        <div>
                            <button onclick="selectAll()" class="secondary">‚úÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                            <button onclick="deselectAll()" class="secondary" style="margin-left: 10px;">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                            <button onclick="cancelSelected()" class="danger" style="margin-left: 10px;">üóëÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                `;
                html += createTable(dataArray);
                html += '</div>';
            }

            container.innerHTML = html;
        }

        function createTable(dataArray) {
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            const columns = [
                { key: 'document_no', label: '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ó‡∏£‡∏î' },
                { key: 'IS_SIGNED', label: '‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', format: (v) => v === '1' ? '‚úÖ ‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß' : '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ã‡πá‡∏ô' },
                { key: 'SIGN_DATE', label: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á' },
                { key: 'document_date', label: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ó‡∏£‡∏î' },
                { key: 'series', label: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' },
                { key: 'category_name', label: '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤' },
                { key: 'brand_name', label: '‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå' },
                { key: 'part_number', label: '‡∏≠‡∏µ‡∏°‡∏µ‡πà/‡∏ã‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏•' },
                { key: 'amount', label: '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô', format: (v) => v ? parseFloat(v).toLocaleString('th-TH', { minimumFractionDigits: 2 }) : '-' },
                { key: 'COUPON_TRADE_IN_CODE', label: '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á' },
                { key: 'invoice_no', label: '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏¥‡∏•‡∏Ç‡∏≤‡∏¢' },
                { key: 'CAMPAIGN_ON_TOP_NAME', label: '‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå' },
                { key: 'COUPON_ON_TOP_BRAND_CODE', label: '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå' },
                { key: 'COUPON_ON_TOP_BRAND_PRICE', label: '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå', format: (v) => v ? parseFloat(v).toLocaleString('th-TH', { minimumFractionDigits: 2 }) : '-' },
                { key: 'COUPON_ON_TOP_COMPANY_CODE', label: '‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó' },
                { key: 'COUPON_ON_TOP_COMPANY_PRICE', label: '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó', format: (v) => v ? parseFloat(v).toLocaleString('th-TH', { minimumFractionDigits: 2 }) : '-' },
                { key: 'customer_name', label: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢' },
                { key: 'customer_phone_number', label: '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢' },
                { key: 'customer_email', label: '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢' },
                { key: 'buyer_name', label: '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠' },
                { key: 'SALE_CODE', label: '‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢' },
                { key: 'SALE_NAME', label: '‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢' },
                { key: 'DOCUMENT_REF_1', label: '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á' },
                { key: 'BIDDING_STATUS_NAME', label: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞' },
                { key: 'CHANGE_REQUEST_COUNT', label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' }
            ];

            let table = '<table class="data-table"><thead><tr>';

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå checkbox
            table += '<th class="checkbox-cell"><input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()"></th>';

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á header
            columns.forEach(col => {
                table += `<th>${col.label}</th>`;
            });
            table += '</tr></thead><tbody>';

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á rows
            dataArray.forEach((item, index) => {
                const tradeInId = item.trade_in_id || '';
                const docNo = item.document_no || '';
                table += `<tr id="row-${index}" data-tradein-id="${tradeInId}" data-doc-no="${docNo}">`;

                // ‡πÄ‡∏û‡∏¥‡πà‡∏° checkbox
                table += `<td class="checkbox-cell"><input type="checkbox" class="row-checkbox" onchange="updateSelectedCount()"></td>`;

                columns.forEach(col => {
                    const value = item[col.key];
                    let displayValue = value === null || value === undefined || value === '' ? '-' : value;

                    // ‡πÉ‡∏ä‡πâ format function ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                    if (col.format && value) {
                        displayValue = col.format(value);
                    }

                    table += `<td>${displayValue}</td>`;
                });
                table += '</tr>';
            });

            table += '</tbody></table>';
            return table;
        }

        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const checkboxes = document.querySelectorAll('.row-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = selectAllCheckbox.checked;
                const row = cb.closest('tr');
                if (cb.checked) {
                    row.classList.add('selected-row');
                } else {
                    row.classList.remove('selected-row');
                }
            });
            updateSelectedCount();
        }

        function selectAll() {
            document.getElementById('selectAllCheckbox').checked = true;
            toggleSelectAll();
        }

        function deselectAll() {
            document.getElementById('selectAllCheckbox').checked = false;
            toggleSelectAll();
        }

        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.row-checkbox:checked');
            const count = checkboxes.length;
            document.getElementById('selectedCount').textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó highlight ‡πÅ‡∏ñ‡∏ß
            document.querySelectorAll('.row-checkbox').forEach(cb => {
                const row = cb.closest('tr');
                if (cb.checked) {
                    row.classList.add('selected-row');
                } else {
                    row.classList.remove('selected-row');
                }
            });
        }

        async function cancelSelected() {
            const checkboxes = document.querySelectorAll('.row-checkbox:checked');

            if (checkboxes.length === 0) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
                return;
            }

            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å localStorage
            const empCode = localStorage.getItem('empCode') || '';
            const empName = localStorage.getItem('empName') || '';
            const empPhone = localStorage.getItem('empPhone') || '';
            const cancelType = localStorage.getItem('cancelType') || '1';
            const reasonCancel = localStorage.getItem('reasonCancel') || '1';

            if (!empCode || !empName || !empPhone) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô)');
                return;
            }

            const tradeInIds = [];
            const docNos = [];

            checkboxes.forEach(cb => {
                const row = cb.closest('tr');
                const tradeInId = row.dataset.tradeinId;
                const docNo = row.dataset.docNo;
                if (tradeInId) tradeInIds.push(tradeInId);
                if (docNo) docNos.push(docNo);
            });

            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            const cancelTypeText = cancelType === '1' ? '‡πÇ‡∏î‡∏ô‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢' : '‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
            const reasonCancelText = reasonCancel === '1' ? '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏à‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏≠‡∏á' :
                reasonCancel === '2' ? '‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£' : '‡∏≠‡∏∑‡πà‡∏ô‡πÜ';

            const reason = prompt('‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ):', reasonCancelText);
            if (reason === null) return;

            const confirmMsg = `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å ${checkboxes.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏ó‡∏£‡∏î:\n${docNos.slice(0, 5).join('\n')}${docNos.length > 5 ? '\n...' : ''}\n\n‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${empName} (${empCode})\n‡πÄ‡∏ö‡∏≠‡∏£‡πå: ${empPhone}\n‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${cancelTypeText}\n‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ${reasonCancelText}\n‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°: ${reason || '-'}`;

            if (!confirm(confirmMsg)) {
                return;
            }

            // ‡πÅ‡∏™‡∏î‡∏á loading
            const originalBtn = event.target;
            originalBtn.disabled = true;
            originalBtn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å...';

            let successCount = 0;
            let failedCount = 0;
            const errors = [];

            // ‡∏î‡∏∂‡∏á Session ID ‡∏à‡∏≤‡∏Å localStorage
            const sessionId = localStorage.getItem('sessionId') || '';
            if (!sessionId) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Session ID ‡∏Å‡πà‡∏≠‡∏ô (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô)');
                originalBtn.disabled = false;
                originalBtn.textContent = 'üóëÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
                return;
            }

            const eveCookies = {
                'ASP.NET_SessionId': sessionId
            };

            // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≤‡∏ô backend
            for (const tradeInId of tradeInIds) {
                try {
                    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    const checkResponse = await fetch('/api/check-cancel', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            tradeInId: tradeInId,
                            cookies: eveCookies
                        })
                    });

                    if (checkResponse.ok) {
                        const checkResult = await checkResponse.json();
                        const canCancel = checkResult.d?.is_success || checkResult.d?.allow_cancel || checkResult.d?.success;

                        if (!canCancel) {
                            failedCount++;
                            const msg = checkResult.d?.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ';
                            errors.push(`ID ${tradeInId}: ${Array.isArray(msg) ? msg.join(', ') : msg}`);
                            continue;
                        }

                        // ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡∏£‡∏¥‡∏á
                        const cancelPayload = {
                            param: {
                                TRADE_IN_ID: tradeInId.toString(),
                                EMP_CODE: empCode,
                                EMP_FULL_NAME: empName,
                                EMP_PHONE_NUMBER: empPhone,
                                REASON: reason || reasonCancelText,
                                CANCEL_STATUS: cancelType,
                                REASON_CANCEL: reasonCancel,
                                DESCRIPTION: reason || '-'
                            }
                        };

                        const cancelResponse = await fetch('/api/cancel-data', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                payload: cancelPayload,
                                cookies: eveCookies
                            })
                        });

                        if (cancelResponse.ok) {
                            const cancelResult = await cancelResponse.json();
                            const isSuccess = cancelResult.d?.is_success || cancelResult.d?.success;

                            if (isSuccess) {
                                successCount++;
                            } else {
                                failedCount++;
                                const msg = cancelResult.d?.message || '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                                errors.push(`ID ${tradeInId}: ${Array.isArray(msg) ? msg.join(', ') : msg}`);
                            }
                        } else {
                            failedCount++;
                            errors.push(`ID ${tradeInId}: HTTP ${cancelResponse.status}`);
                        }
                    } else {
                        failedCount++;
                        errors.push(`ID ${tradeInId}: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à HTTP ${checkResponse.status}`);
                    }
                } catch (error) {
                    failedCount++;
                    errors.push(`ID ${tradeInId}: ${error.message}`);
                }
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            if (successCount > 0) {
                let msg = `‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                if (failedCount > 0) {
                    msg += `\n‚ùå ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ${failedCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                    if (errors.length > 0) {
                        msg += '\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:\n' + errors.slice(0, 5).join('\n');
                    }
                }
                alert(msg);
                await searchData();
            } else {
                let msg = `‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${failedCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                if (errors.length > 0) {
                    msg += '\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:\n' + errors.slice(0, 5).join('\n');
                }
                alert(msg);
            }

            originalBtn.disabled = false;
            originalBtn.textContent = 'üóëÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
        document.getElementById('reportForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await generateReport();
        });

        function resetReportForm() {
            document.getElementById('reportForm').reset();
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            document.getElementById('reportDateStart').valueAsDate = yesterday;
            document.getElementById('reportDateEnd').valueAsDate = today;
        }

        async function generateReport() {
            const container = document.getElementById('reportContainer');
            const submitBtn = document.querySelector('#reportForm button[type="submit"]');

            container.innerHTML = '<div class="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô...</div>';
            submitBtn.disabled = true;

            // ‡∏î‡∏∂‡∏á Session ID ‡∏à‡∏≤‡∏Å localStorage
            const sessionId = localStorage.getItem('sessionId') || '';
            
            const params = new URLSearchParams({
                saleCode: document.getElementById('reportSaleCode').value,
                dateStart: formatDateThai(document.getElementById('reportDateStart').value),
                dateEnd: formatDateThai(document.getElementById('reportDateEnd').value),
                sessionId: sessionId,
                customerSign: ''  // ‡∏î‡∏∂‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏ã‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß + ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ã‡πá‡∏ô)
            });

            try {
                const response = await fetch(`/api/report?${params}`);
                const data = await response.json();

                if (data.error) {
                    container.innerHTML = `
                        <div class="error">
                            <h3>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                            <p>${data.error}</p>
                        </div>
                    `;
                } else {
                    displayReport(data);
                }
            } catch (error) {
                container.innerHTML = `
                    <div class="error">
                        <h3>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            } finally {
                submitBtn.disabled = false;
            }
        }

        function displayReport(data) {
            const container = document.getElementById('reportContainer');
            const reportData = data.report || {};
            
            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ copy
            currentReportData = data;

            let html = `
                <div style="text-align: right; margin-bottom: 15px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="copyReportText()" style="background: #28a745; padding: 10px 20px;">üìã Copy ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                    <button onclick="sendToTelegram()" style="background: #0088cc; padding: 10px 20px;">üì§ ‡∏™‡πà‡∏á‡πÑ‡∏õ Telegram</button>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">üìä ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div style="font-size: 32px; font-weight: bold;">${reportData.totalCount || 0}</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    </div>

                    <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">üí∞ ‡∏¢‡∏≠‡∏î‡πÄ‡∏ó‡∏£‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div style="font-size: 28px; font-weight: bold;">${(reportData.totalAmount || 0).toLocaleString('th-TH', { minimumFractionDigits: 2 })}</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">‡∏ö‡∏≤‡∏ó</div>
                    </div>

                    <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">‚úÖ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡∏•‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</div>
                        <div style="font-size: 28px; font-weight: bold;">${(reportData.confirmedAmount || 0).toLocaleString('th-TH', { minimumFractionDigits: 2 })}</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">${reportData.confirmedCount || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô+‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î)</div>
                    </div>

                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px;">‚ùå ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏Å‡∏•‡∏á</div>
                        <div style="font-size: 32px; font-weight: bold;">${reportData.notConfirmedCount || 0}</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ)</div>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">üìÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÄ‡∏ó‡∏£‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th style="text-align: right;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                    <th style="text-align: right;">‡∏¢‡∏≠‡∏î‡πÄ‡∏ó‡∏£‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)</th>
                                    <th style="text-align: right;">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡∏•‡∏á (‡∏ö‡∏≤‡∏ó)</th>
                                    <th style="text-align: right;">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡∏Å‡∏•‡∏á (%)</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            const dailySummary = reportData.dailySummary || {};
            for (const [date, info] of Object.entries(dailySummary)) {
                const confirmedCount = info.confirmedCount || 0;
                const totalCount = info.count || 0;
                const rate = totalCount > 0 ? ((confirmedCount / totalCount) * 100).toFixed(1) : 0;
                const notConfirmedCount = totalCount - confirmedCount;
                html += `
                    <tr>
                        <td><strong>${date}</strong></td>
                        <td style="text-align: right;">${totalCount} <span style="color: #999; font-size: 11px;">(‚úÖ${confirmedCount} ‚ùå${notConfirmedCount})</span></td>
                        <td style="text-align: right;">${(info.totalAmount || 0).toLocaleString('th-TH', { minimumFractionDigits: 2 })}</td>
                        <td style="text-align: right; color: #11998e; font-weight: 600;">${(info.confirmedAmount || 0).toLocaleString('th-TH', { minimumFractionDigits: 2 })}</td>
                        <td style="text-align: right;">${rate}%</td>
                    </tr>
                `;
            }

            html += `
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">üë§ ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÄ‡∏ó‡∏£‡∏î‡∏ï‡∏≤‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢</h3>
                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                                    <th style="text-align: right;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                    <th style="text-align: right;">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡∏Å‡∏•‡∏á (%)</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            const salesSummary = reportData.salesSummary || {};
            for (const [saleCode, info] of Object.entries(salesSummary)) {
                const confirmedCount = info.confirmedCount || 0;
                const totalCount = info.count || 0;
                const rate = totalCount > 0 ? ((confirmedCount / totalCount) * 100).toFixed(1) : 0;
                const notConfirmedCount = totalCount - confirmedCount;
                html += `
                    <tr>
                        <td><strong>${saleCode}</strong></td>
                        <td style="text-align: right;">${totalCount} <span style="color: #999; font-size: 11px;">(‚úÖ${confirmedCount} ‚ùå${notConfirmedCount})</span></td>
                        <td style="text-align: right; font-weight: 600; color: ${rate >= 50 ? '#11998e' : '#f5576c'};">${rate}%</td>
                    </tr>
                `;
            }

            html += `
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h3>
                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th style="text-align: right;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                    <th style="text-align: right;">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            const statusSummary = reportData.statusSummary || {};
            for (const [status, info] of Object.entries(statusSummary)) {
                html += `
                    <tr>
                        <td>${status}</td>
                        <td style="text-align: right;">${info.count || 0}</td>
                        <td style="text-align: right;">${(info.amount || 0).toLocaleString('th-TH', { minimumFractionDigits: 2 })}</td>
                    </tr>
                `;
            }

            html += `
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="background: white; padding: 20px; border-radius: 15px;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">üì± ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</h3>
                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå</th>
                                    <th style="text-align: right;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                    <th style="text-align: right;">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            const brandSummary = reportData.brandSummary || {};
            for (const [brand, info] of Object.entries(brandSummary)) {
                html += `
                    <tr>
                        <td>${brand}</td>
                        <td style="text-align: right;">${info.count || 0}</td>
                        <td style="text-align: right;">${(info.amount || 0).toLocaleString('th-TH', { minimumFractionDigits: 2 })}</td>
                    </tr>
                `;
            }

            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ copy
        let currentReportData = null;

        async function sendToTelegram() {
            if (!currentReportData) {
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô');
                return;
            }

            // ‡∏î‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram ‡∏à‡∏≤‡∏Å localStorage
            const botToken = localStorage.getItem('telegramBotToken') || '';
            const chatId = localStorage.getItem('telegramChatId') || '';

            if (!botToken || !chatId) {
                const setup = confirm('‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram Bot\n\n‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');
                if (setup) {
                    showTelegramSetup();
                }
                return;
            }

            const report = currentReportData.report;
            const dateStart = document.getElementById('reportDateStart').value;
            const dateEnd = document.getElementById('reportDateEnd').value;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
            let message = `üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏ó‡∏£‡∏î\n`;
            message += `üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${dateStart} - ${dateEnd}\n`;
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            message += `üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°\n`;
            message += `‚Ä¢ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${report.totalCount || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n`;
            message += `‚Ä¢ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡∏•‡∏á: ${report.confirmedCount || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n`;
            message += `‚Ä¢ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏Å‡∏•‡∏á: ${report.notConfirmedCount || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n\n`;
            message += `üë§ ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô\n`;
            
            const salesSummary = report.salesSummary || {};
            for (const [saleCode, info] of Object.entries(salesSummary)) {
                const confirmedCount = info.confirmedCount || 0;
                const totalCount = info.count || 0;
                const notConfirmedCount = totalCount - confirmedCount;
                message += `${saleCode}: ${totalCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‚úÖ${confirmedCount} ‚ùå${notConfirmedCount})\n`;
            }
            
            message += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;

            // ‡πÅ‡∏™‡∏î‡∏á loading
            const button = event.target;
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';

            try {
                const response = await fetch('/api/send-telegram', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        botToken: botToken,
                        chatId: chatId,
                        message: message
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('‚úÖ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏õ Telegram ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                } else {
                    alert('‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + result.error);
                }
            } catch (error) {
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = originalText;
            }
        }

        function showTelegramSetup() {
            const botToken = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Telegram Bot Token:\n\n(‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô TELEGRAM-SETUP.md)', localStorage.getItem('telegramBotToken') || '');
            if (!botToken) return;

            const chatId = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Chat ID:\n\n(‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤‡πÉ‡∏ô TELEGRAM-SETUP.md)', localStorage.getItem('telegramChatId') || '');
            if (!chatId) return;

            localStorage.setItem('telegramBotToken', botToken);
            localStorage.setItem('telegramChatId', chatId);

            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Telegram ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß');
        }

        function copyReportText() {
            if (!currentReportData) {
                alert('‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô');
                return;
            }

            const report = currentReportData.report;
            const dateStart = document.getElementById('reportDateStart').value;
            const dateEnd = document.getElementById('reportDateEnd').value;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
            let text = `üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏ó‡∏£‡∏î\n`;
            text += `üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${dateStart} - ${dateEnd}\n`;
            text += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;

            // ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
            text += `üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°\n`;
            text += `‚Ä¢ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${report.totalCount || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n`;
            text += `‚Ä¢ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏Å‡∏•‡∏á: ${report.confirmedCount || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n`;
            text += `‚Ä¢ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏Å‡∏•‡∏á: ${report.notConfirmedCount || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n\n`;

            // ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
            text += `üë§ ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô\n`;
            const salesSummary = report.salesSummary || {};
            for (const [saleCode, info] of Object.entries(salesSummary)) {
                const confirmedCount = info.confirmedCount || 0;
                const totalCount = info.count || 0;
                const notConfirmedCount = totalCount - confirmedCount;
                text += `${saleCode}: ${totalCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‚úÖ${confirmedCount} ‚ùå${notConfirmedCount})\n`;
            }
            
            text += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;

            // Copy to clipboard
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Copy ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô LINE ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢');
            }).catch(err => {
                // Fallback: ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô modal
                const modal = document.createElement('div');
                modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';
                modal.innerHTML = `
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; max-height: 80vh; overflow-y: auto;">
                        <h3 style="margin-bottom: 15px;">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏ó‡∏£‡∏î</h3>
                        <textarea readonly style="width: 100%; height: 400px; padding: 10px; font-family: monospace; font-size: 13px; border: 1px solid #ddd; border-radius: 5px;">${text}</textarea>
                        <div style="margin-top: 15px; text-align: right;">
                            <button onclick="this.closest('div').parentElement.remove()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">‡∏õ‡∏¥‡∏î</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                modal.querySelector('textarea').select();
            });
        }
    </script>
</body>

</html>